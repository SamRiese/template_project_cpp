name: Build tests
run-name: build_tests
on: [push]
jobs:
  build-ubuntu-focal:
    runs-on: ubuntu-latest
    container:
      image: ubuntu:focal
      env:
        TZ: Europe/Berlin
    steps:
    - name: 'Install git'
      run: |
        apt update
        apt install -y git
    - name: 'Checkout repository'
      uses: actions/checkout@v3
      with:
        submodules: true
    - name: 'Install dependencies'
      run: |
        ln -snf /usr/share/zoneinfo/$TZ /etc/localtime && echo $TZ > /etc/timezone
        bash scripts/install_dependencies_debian_ubuntu.sh
    - name: 'Build'
      run: |
        mkdir build/
        cd build/
        cmake ..
        make -j3
    - name: 'Smoke test'
      run: |
        cd build/apps/example_app/
        ./example_app
  build-ubuntu-jammy:
    runs-on: ubuntu-latest
    container:
      image: ubuntu:jammy
    steps:
    - name: 'Install git'
      run: |
        apt update
        apt install -y git
    - name: 'Checkout repository'
      uses: actions/checkout@v3
      with:
        submodules: true
    - name: 'Install dependencies'
      run: |
        bash scripts/install_dependencies_debian_ubuntu.sh
    - name: 'Build'
      run: |
        mkdir build/
        cd build/
        cmake ..
        make -j3
    - name: 'Smoke test'
      run: |
        cd build/apps/example_app/
        ./example_app
  build-debian-latest:
    runs-on: ubuntu-latest
    container:
      image: debian:latest
    steps:
    - name: 'Install git'
      run: |
        apt update
        apt install -y git
    - name: 'Checkout repository'
      uses: actions/checkout@v3
      with:
        submodules: true
    - name: 'Install dependencies'
      run: |
        bash scripts/install_dependencies_debian_ubuntu.sh
    - name: 'Build'
      run: |
        mkdir build/
        cd build/
        cmake ..
        make -j3
    - name: 'Smoke test'
      run: |
        cd build/apps/example_app/
        ./example_app
  build-arch-latest:
    runs-on: ubuntu-latest
    container:
      image: archlinux:latest
    steps:
    - name: 'Install git'
      run: |
        pacman -Syu --noconfirm git
    - name: 'Checkout repository'
      uses: actions/checkout@v3
      with:
        submodules: true
    - name: 'Install dependencies'
      run: |
        bash scripts/install_dependencies_arch.sh
    - name: 'Build'
      run: |
        mkdir build/
        cd build/
        cmake ..
        make -j3
    - name: 'Smoke test'
      run: |
        cd build/apps/example_app/
        ./example_app
